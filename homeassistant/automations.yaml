- id: "1739307600001"
  alias: "Nibe TUV komfort - zapis do modbus"
  description: "Při změně input_select zapíše novou hodnotu do Nibe registru 47041"
  triggers:
    - trigger: state
      entity_id: input_select.nibe_tuv_komfort
  conditions: []
  actions:
    - choose:
        - conditions:
            - condition: state
              entity_id: input_select.nibe_tuv_komfort
              state: "Ekonomický"
          sequence:
            - action: modbus.write_register
              data:
                hub: nibe
                slave: 1
                address: 47041
                value: [0]
        - conditions:
            - condition: state
              entity_id: input_select.nibe_tuv_komfort
              state: "Normální"
          sequence:
            - action: modbus.write_register
              data:
                hub: nibe
                slave: 1
                address: 47041
                value: [1]
        - conditions:
            - condition: state
              entity_id: input_select.nibe_tuv_komfort
              state: "Luxusní"
          sequence:
            - action: modbus.write_register
              data:
                hub: nibe
                slave: 1
                address: 47041
                value: [2]
        - conditions:
            - condition: state
              entity_id: input_select.nibe_tuv_komfort
              state: "Smart Control"
          sequence:
            - action: modbus.write_register
              data:
                hub: nibe
                slave: 1
                address: 47041
                value: [4]
  mode: single
- id: "1739307600002"
  alias: "Nibe TUV komfort - sync z modbus"
  description: "Při změně modbus sensoru synchronizuje input_select"
  triggers:
    - trigger: state
      entity_id: sensor.nibe_rezim_komfortu_tuv
  conditions:
    - condition: template
      value_template: "{{ trigger.to_state.state not in ['unavailable', 'unknown'] }}"
  actions:
    - action: input_select.select_option
      target:
        entity_id: input_select.nibe_tuv_komfort
      data:
        option: >
          {% set val = states('sensor.nibe_rezim_komfortu_tuv') | int(-1) %}
          {% if val == 0 %}Ekonomický{% elif val == 1 %}Normální{% elif val == 2 %}Luxusní{% elif val == 4 %}Smart Control{% else %}Normální{% endif %}
  mode: single
- id: "1746052767671"
  alias: Publikuj VIctron
  description: ""
  triggers:
    - trigger: time_pattern
      seconds: /30
  conditions: []
  actions:
    - action: mqtt.publish
      data:
        evaluate_payload: false
        qos: 0
        retain: false
        topic: victron/R/c0619ab69c71/system/0/Serial
  mode: single
- id: "1746482790388"
  alias: Auto má hlad
  description: ""
  triggers:
    - trigger: time_pattern
      hours: "*"
      minutes: /1
  conditions:
    - condition: or
      conditions:
        - alias: Wallbox garáž je charging
          condition: numeric_state
          entity_id: sensor.charger_state_garage
          above: 1
          below: 3
        - condition: numeric_state
          entity_id: sensor.charger_state_garage
          above: 3
          below: 5
          alias: Wallbox garáž je waiting for sun
        - alias: Wallbox zahrada je charging
          condition: numeric_state
          entity_id: sensor.stav_wallboxu_venek
          above: 1
          below: 3
        - alias: Wallbox zahrada je waiting for sun
          condition: numeric_state
          entity_id: sensor.stav_wallboxu_venek
          above: 3
          below: 5
        - alias: Wallbox garáž je Waiting for start nebo Low SOC
          condition: numeric_state
          entity_id: sensor.charger_state_garage
          above: 5
          below: 8
        - alias: Wallbox zahrada je Waiting for start nebo Low SOC
          condition: numeric_state
          entity_id: sensor.stav_wallboxu_venek
          above: 5
          below: 8
  actions:
    - action: input_boolean.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: input_boolean.auto_ma_hlad
  mode: single
- id: "1746483353432"
  alias: Auto nemá hlad
  description: ""
  triggers:
    - trigger: time_pattern
      hours: "*"
      minutes: /1
  conditions:
    - condition: not
      conditions:
        - alias: Wallbox garáž je charging
          condition: numeric_state
          entity_id: sensor.charger_state_garage
          above: 1
          below: 3
        - condition: numeric_state
          entity_id: sensor.charger_state_garage
          above: 3
          below: 5
          alias: Wallbox garáž je waiting for sun
        - alias: Wallbox zahrada je charging
          condition: numeric_state
          entity_id: sensor.stav_wallboxu_venek
          above: 1
          below: 3
        - alias: Wallbox zahrada je waiting for sun
          condition: numeric_state
          entity_id: sensor.stav_wallboxu_venek
          above: 3
          below: 5
        - alias: Wallbox garáž je Waiting for start nebo Low SOC
          condition: numeric_state
          entity_id: sensor.charger_state_garage
          above: 5
          below: 8
        - alias: Wallbox zahrada je Waiting for start nebo Low SOC
          condition: numeric_state
          entity_id: sensor.stav_wallboxu_venek
          above: 5
          below: 8
  actions:
    - action: input_boolean.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: input_boolean.auto_ma_hlad
  mode: single
- id: "1746747997553"
  alias: Spusť nabíjení auta manuálně
  description: ""
  triggers:
    - trigger: event
      event_type: run
      event_data: {}
  conditions: []
  actions:
    - action: select.select_option
      metadata: {}
      data:
        option: Manual
      target:
        entity_id:
          - select.wallbox_garaz_mod
          - select.wallbox_zahrada_mod
    - action: switch.turn_on
      metadata: {}
      data: {}
      target:
        entity_id:
          - switch.wallbox_garaz_start_stop
          - switch.wallbox_zahrada_start_stop
  mode: single
